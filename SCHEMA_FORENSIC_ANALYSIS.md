# SCHEMA-LEVEL FORENSIC ANALYSIS: Uniform Product Persistence

## STEP 2: UNIFORM SCHEMA INSPECTION

### Required Fields (required: true)
1. **id** (String)
   - Required: ✅ true
   - Unique: ✅ true
   - Validation: ✅ `/^\d{6}$/` (exactly 6 digits)
   - Expected: String matching pattern `^\d{6}$`

2. **name** (String)
   - Required: ✅ true
   - Expected: Non-empty string

3. **category** (String)
   - Required: ✅ true
   - Enum: ✅ ['shirt', 'pant', 'shoe', 'jacket', 'accessory']
   - Expected: One of enum values

4. **gender** (String)
   - Required: ✅ true
   - Enum: ✅ ['male', 'female', 'unisex']
   - Expected: One of enum values

5. **sizes** (Array[String])
   - Required: ✅ true
   - Expected: Array of strings (non-empty array)

6. **price** (Number)
   - Required: ✅ true
   - Expected: Number

7. **image** (String)
   - Required: ✅ true
   - Expected: Non-empty string

8. **sku** (String)
   - Required: ✅ true
   - Unique: ✅ true
   - Expected: Non-empty string

9. **stock** (Number)
   - Required: ✅ true
   - Default: ✅ 0
   - Expected: Number

### Optional Fields
- **companyIds** (Array[ObjectId])
  - Default: ✅ []
  - Expected: Array of ObjectIds or empty array

- **attribute1_name**, **attribute2_name**, **attribute3_name** (String)
  - Required: ❌ false
  - Expected: String or undefined

- **attribute1_value**, **attribute2_value**, **attribute3_value** (Mixed)
  - Required: ❌ false
  - Expected: String, Number, or undefined

### Timestamps
- **createdAt** (Date) - Auto-generated by `timestamps: true`
- **updatedAt** (Date) - Auto-generated by `timestamps: true`

### Middleware/Hooks
- ❌ NO pre-save hooks
- ❌ NO post-save hooks
- ❌ NO pre-validate hooks
- ❌ NO post-validate hooks

### Indexes
- `id`: unique index (automatic from unique: true)
- `sku`: unique index (automatic from unique: true)
- `companyIds`: index
- `category + gender`: compound index

## STEP 3: PAYLOAD INSPECTION (To be logged)

## STEP 4: SCHEMA VS PAYLOAD DIFF (To be compared)

## STEP 5: MIDDLEWARE ISOLATION
- No middleware to isolate

## STEP 6: ERROR SURFACING
- Diagnostic code added to `createProduct` function

